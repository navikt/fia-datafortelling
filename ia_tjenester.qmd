---
title: "IA-tjenester i Fia"
subtitle: IA-tjenester er utfaset med samarbeidsplan i Fia.
title-block-banner: true
title-block-banner-color: white
date: now
date-format: "DD.MM.YYYY HH:mm:ss z"
published-title: "Oppdatert"
author: Team Pia
author-title: "Eier"
execute:
    echo: false
    warning: false
    daemon: false
format:
    html:
        toc: true
        toc-title: Indeks
        page-layout: full
        embed-resources: true
jupyter: python3
---

<span style="color:red;">
NB! Dette er ikke offisiell statistikk og må ikke deles utenfor NAV.
</span>

```{python}
%load_ext autoreload
%autoreload 2

import os

from datahandler import (
    load_data_deduplicate,
    preprocess_data_statistikk,
    split_data_statistikk,
    preprocess_data_status,
    preprocess_data_leveranse,
    hent_leveranse_sistestatus,
    filtrer_bort_saker_på_avsluttet_tidspunkt,
)
from plots_leveranse import (
    antall_leveranser_per_tjeneste,
    leveranse_tjeneste_per_maaned,
)


PROJECT = os.environ['GCP_PROJECT']
DATASET = os.environ['DATASET']
raw_data_statistikk = load_data_deduplicate(PROJECT, DATASET, "ia-sak-statistikk-v1", "endretAvHendelseId")
raw_data_leveranse = load_data_deduplicate(PROJECT, DATASET, "ia-sak-leveranse-v1", "id, status")

data_statistikk = preprocess_data_statistikk(raw_data_statistikk)
data_status, data_eierskap, _ = split_data_statistikk(data_statistikk)
data_status = preprocess_data_status(data_status)
data_leveranse = preprocess_data_leveranse(raw_data_leveranse)
data_leveranse_sistestatus = hent_leveranse_sistestatus(data_leveranse)
```

## IA-tjenester
Når en sak har status "Vi bistår" kan eier av saken registrere hvilke IA-tjenester som er under arbeid eller levert.
En sak kan ikke gå videre til status "Fullført" før alle registrerte IA-tjenester er satt som levert eller er slettet.
Slettet IA-tjenester vises ikke i grafene under.

```{python}
# Filtrerer bort saker avsluttet for over ett år siden
data_status_siste_år = filtrer_bort_saker_på_avsluttet_tidspunkt(data_status)
data_leveranse_sistestatus_siste_år = data_leveranse_sistestatus[data_leveranse_sistestatus.saksnummer.isin(data_status_siste_år.saksnummer.unique())]
```

::: {.panel-tabset}

## Levert per måned
```{python}
leveranse_tjeneste_per_maaned(data_leveranse_sistestatus_siste_år)
```

## Antall saker per IA-tjeneste
Antall saker som er registrert med IA-tjenester, fordelt etter IA-tjeneste og dens status.
```{python}
antall_leveranser_per_tjeneste(data_leveranse_sistestatus_siste_år)
```

:::

{{< include includes/leveransestatus-forklaring.qmd >}}
