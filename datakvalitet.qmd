---
title: "Fia datakvalitet"
subtitle: Statistikk som viser datakvalitet i Fia - Fagsystemet for oppfølging av IA-oppdraget i NAV.
title-block-banner: true
title-block-banner-color: white
date: now
date-format: "DD.MM.YYYY HH:mm:ss z"
published-title: "Oppdatert"
author: Team Pia
author-title: "Eier"
execute:
    echo: false
    warning: false
format:
    html:
        toc: true
        toc-title: Indeks
        page-layout: full
        embed-resources: true
jupyter: python3
---

Ansvarlig team er [Team Pia](https://teamkatalog.nav.no/team/b347ac99-c382-4e5a-a1dd-532e91110e2a).
Kontakt oss på [slack](https://nav-it.slack.com/archives/C02DL347ZT2) eller på e-post `pia@nav.no`.

Kildekoden finnes på [GitHub](https://github.com/navikt/fia-datafortelling).

<span style="color:red;">
NB! Dette er ikke offisiell statistikk og må ikke deles utenfor NAV.
</span>

```{python}
import os

from code.datahandler import (
    load_data,
    load_data_deduplicate,
    preprocess_data_statistikk,
    split_data_statistikk,
    preprocess_data_status,
    preprocess_data_leveranse,
    kollaps_leveranse_historikk,
    beregn_intervall_tid_siden_siste_endring,
    explode_ikke_aktuell_begrunnelse,
)
from code.plots_datakvalitet import (
    saker_per_status_over_tid,
    dager_mellom_statusendringer,
    urørt_saker_over_tid,
    median_og_gjennomsnitt_av_tid_mellom_statusendringer,
    antall_saker_per_eier,
    for_lavt_sykefravær,
    mindre_virksomhet,
    fullført_per_måned,
    andel_fullforte_saker_med_leveranse_per_måned,
    andel_fullforte_saker_med_leveranse_over_tid,
    forskjell_frist_fullfort,
)


PROJECT = os.environ['GCP_PROJECT']
DATASET = os.environ['DATASET']
raw_data_statistikk = load_data_deduplicate(PROJECT, DATASET, "ia-sak-statistikk-v1")
raw_data_leveranse = load_data(PROJECT, DATASET, "ia-sak-leveranse-v1")

data_statistikk = preprocess_data_statistikk(raw_data_statistikk)
data_status, data_eierskap = split_data_statistikk(data_statistikk)
data_status = preprocess_data_status(data_status)
data_leveranse = preprocess_data_leveranse(raw_data_leveranse)
data_siste_leveranse = kollaps_leveranse_historikk(data_leveranse)
ikke_aktuell = explode_ikke_aktuell_begrunnelse(data_status)
```


## Antall saker per status over tid
```{python}
saker_per_status_over_tid(data_status)
```

## Tid mellom statusendringer
Grafene under viser hvor lenge saker står i en status (før de går over i en annen).
Vi har valgt å dele intervaller på en ujevn måte for å kunne se om endringer tar kort eller lang tid.
Hver bar viser gjeldende periode (fra og med, til).

```{python}
data_status = beregn_intervall_tid_siden_siste_endring(data_status)
```

::: {.panel-tabset}

## Fra Vurderes
::: {.panel-tabset}
## Til Kontaktes
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VURDERES") & (data_status.status=="KONTAKTES")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VURDERES") & (data_status.status=="KONTAKTES")]
)
```
## Til Ikke aktuell
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VURDERES") & (data_status.status=="IKKE_AKTUELL")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VURDERES") & (data_status.status=="IKKE_AKTUELL")]
)
```
## Til Slettet
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VURDERES") & (data_status.status=="SLETTET")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VURDERES") & (data_status.status=="SLETTET")]
)
```
## Til Kontaktes, Ikke aktuell eller Slettet
```{python}
dager_mellom_statusendringer(
    data_status[data_status.forrige_status=="VURDERES"]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[data_status.forrige_status=="VURDERES"]
)
```
:::

## Fra Kontaktes
::: {.panel-tabset}
## Til Kartlegges
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KONTAKTES") & (data_status.status=="KARTLEGGES")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KONTAKTES") & (data_status.status=="KARTLEGGES")]
)
```
## Til Ikke aktuell
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KONTAKTES") & (data_status.status=="IKKE_AKTUELL")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KONTAKTES") & (data_status.status=="IKKE_AKTUELL")]
)
```
## Til Kartlegges eller Ikke aktuell
```{python}
dager_mellom_statusendringer(
    data_status[data_status.forrige_status=="KONTAKTES"]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[data_status.forrige_status=="KONTAKTES"]
)
```
:::

## Fra Kartlegges
::: {.panel-tabset}
## Til Vi bistår
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KARTLEGGES") & (data_status.status=="VI_BISTÅR")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KARTLEGGES") & (data_status.status=="VI_BISTÅR")]
)
```
## Til Ikke aktuell
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KARTLEGGES") & (data_status.status=="IKKE_AKTUELL")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="KARTLEGGES") & (data_status.status=="IKKE_AKTUELL")]
)
```
## Til Vi bistår eller Ikke aktuell
```{python}
dager_mellom_statusendringer(
    data_status[data_status.forrige_status=="KARTLEGGES"]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[data_status.forrige_status=="KARTLEGGES"]
)
```
:::

## Fra Vi bistår
::: {.panel-tabset}
## Til Fullført
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VI_BISTÅR") & (data_status.status=="FULLFØRT")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VI_BISTÅR") & (data_status.status=="FULLFØRT")]
)
```
## Til Ikke aktuell
```{python}
dager_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VI_BISTÅR") & (data_status.status=="IKKE_AKTUELL")]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[(data_status.forrige_status=="VI_BISTÅR") & (data_status.status=="IKKE_AKTUELL")]
)
```
## Til Fullført eller Ikke aktuell
```{python}
dager_mellom_statusendringer(
    data_status[data_status.forrige_status=="VI_BISTÅR"]
)
```
```{python}
median_og_gjennomsnitt_av_tid_mellom_statusendringer(
    data_status[data_status.forrige_status=="VI_BISTÅR"]
)
```
:::
:::


## Antal saker som ligger urørt i Fia
Grafene under viser, per beregningsdato, hvor mange saker som ikke var oppdatert i Fia i 90 dager.
En oppdatering er at noen har tatt eierskap til en sak, en endring av status eller en leveranse som er lagt til eller satt til levert.
Hvis en statusendring blir angret (ved bruk av tilbake-knappen) eller en leveranse blir slettet, telles ikke dette som oppdatering.

```{python}
urørt_saker_over_tid(data_status, data_eierskap, data_leveranse, antall_dager=90)
```


## Antall saker per eier
Vise antall saker i status "Vi bistår" eller "Fullført" per eier. Gjelder bare siste eier per sak.

```{python}
antall_saker_per_eier(data_status)
```


## Stemmer begrunnelse på ikke aktuell med virksomhetsprofil?
Biståtte saker er de i status "Vi bistår" eller "Fullført".

### For lavt sykefravær
Sammenligner saker i status ikke aktuell og begrunnelse "For lavt sykefravær", med biståtte saker.
```{python}
for_lavt_sykefravær(data_status, ikke_aktuell)
```

### Mindre virksomhet
Sammenligner saker i status ikke aktuell og begrunnelse "Mindre virksomher", med biståtte saker.
Alle saker med over 150 ansatte havner i den siste søylen.
```{python}
mindre_virksomhet(data_status, ikke_aktuell)
```


## Antall fullførte saker per måned
```{python}
fullført_per_måned(data_status)
```


## Andel fullførte saker med leveranse registrert
```{python}
andel_fullforte_saker_med_leveranse_per_måned(data_status, data_leveranse)
```
```{python}
andel_fullforte_saker_med_leveranse_over_tid(data_status, data_leveranse)
```


## Forskjellen mellom frist og fullført dato
```{python}
forskjell_frist_fullfort(data_siste_leveranse)
```