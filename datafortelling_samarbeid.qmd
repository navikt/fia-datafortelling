```{python}
from src.utils.datahandler import fullførte_samarbeid_med_tid,samarbeid_med_spørreundersøkelse
from src.plots.samarbeid import  plot_tid_mellom_hendelser
from src.utils.konstanter import Sektor
import pandas as pd

```


{{< include includes/under_arbeid_callout.qmd >}}


# Tid brukt i samarbeid - (Opprettet - Gjennomført behovsvurdering)
Antall dager mellom opprettelse av et samarbeid og gjennomføring av første behovsvurdering.

```{python}
data_i_alle_sektorer = samarbeid_med_spørreundersøkelse(
    data_samarbeid=data_samarbeid,
    data_spørreundersøkelse=data_spørreundersøkelse,
    type_spørreundersøkelse="Behovsvurdering",
)
data_i_statlig_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.STATLIG.name]

data_i_kommunal_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.KOMMUNAL.name]

data_i_privat_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.PRIVAT.name]
```

::: {.panel-tabset}

## Alle
Alle behovsvurderinger
```{python}
fig, y_max = plot_tid_mellom_hendelser(
    df=data_i_alle_sektorer,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_behovsvurdering_fullfort",
    hendelse_navn="Behovsvurdering",
)

fig.show()
```

## Statlig sektor
Alle behovsvurderinger knyttet til virksomheter definert som Statlig forvaltning (i Fia)
```{python}
fig, _ = plot_tid_mellom_hendelser(
    df=data_i_statlig_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_behovsvurdering_fullfort",
    hendelse_navn="Behovsvurdering",
    yaxis_range_max=y_max,
)

fig.show()
```

## Kommunal sektor
Alle behovsvurderinger knyttet til virksomheter definert som Kommunal forvaltning (i Fia)
```{python}
fig, _ = plot_tid_mellom_hendelser(
    df=data_i_kommunal_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_behovsvurdering_fullfort",
    hendelse_navn="Behovsvurdering",
    yaxis_range_max=y_max,
)

fig.show()
```

## Privat sektor
Alle behovsvurderinger knyttet til virksomheter definert som Privat og offentlig næringsvirksomhet (i Fia)
```{python}
fig, _ = plot_tid_mellom_hendelser(
    df=data_i_privat_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_behovsvurdering_fullfort",
    hendelse_navn="Behovsvurdering",
    yaxis_range_max=y_max,
)

fig.show()
```

:::

# Tid brukt i samarbeid - (Opprettet - Gjennomført evaluering)
Antall dager mellom opprettelse av et samarbeid og gjennomføring av første evaluering.
```{python}
data_i_alle_sektorer = samarbeid_med_spørreundersøkelse(
    data_samarbeid=data_samarbeid,
    data_spørreundersøkelse=data_spørreundersøkelse,
    type_spørreundersøkelse="Evaluering",
)
data_i_statlig_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.STATLIG.name]

data_i_kommunal_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.KOMMUNAL.name]

data_i_privat_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.PRIVAT.name]
```


::: {.panel-tabset}
## Alle
Alle evalueringer
```{python}
fig, y_max = plot_tid_mellom_hendelser(
    df=data_i_alle_sektorer,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_evaluering_fullfort",
    hendelse_navn="Evaluering",
)

fig.show()
```

## Statlig sektor
Alle evalueringer knyttet til virksomheter kategorisert som Statlig forvaltning (i Fia)
```{python}
fig, _ = plot_tid_mellom_hendelser(
    df=data_i_statlig_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_evaluering_fullfort",
    hendelse_navn="Evaluering",
    yaxis_range_max=y_max,
)

fig.show()
```

## Kommunal sektor
Alle evalueringer knyttet til virksomheter kategorisert som Kommunal forvaltning (i Fia)
```{python}
fig, _ = plot_tid_mellom_hendelser(
    df=data_i_kommunal_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_evaluering_fullfort",
    hendelse_navn="Evaluering",
    yaxis_range_max=y_max,
)

fig.show()
```

## Privat sektor
Alle evalueringer knyttet til virksomheter kategorisert som Privat og offentlig næringsvirksomhet (i Fia)
```{python}
fig, _ = plot_tid_mellom_hendelser(
    df=data_i_privat_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="tidligste_evaluering_fullfort",
    hendelse_navn="Evaluering",
    yaxis_range_max=y_max,
)

fig.show()
```

:::

# Tid brukt i samarbeid - (Opprettet - Fullført samarbeid)
Antall dager mellom opprettelse av et samarbeid og når det er satt i status 'fullført'

::: {.panel-tabset}

```{python}
# Samarbeid som er fullført og tid det tok å fullføre
data_i_alle_sektorer = fullførte_samarbeid_med_tid(
    data_samarbeid=data_samarbeid,
)

data_i_statlig_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.STATLIG.name]

data_i_kommunal_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.KOMMUNAL.name]

data_i_privat_sektor = pd.DataFrame() if data_i_alle_sektorer.empty else data_i_alle_sektorer[data_i_alle_sektorer["sektor"] == Sektor.PRIVAT.name]
```

## Alle
Alle samarbeid som er fullført

```{python}
fig, y_max = plot_tid_mellom_hendelser(
    df=data_i_alle_sektorer,
    kolonne_start="opprettet",
    kolonne_slutt="fullfort",
    hendelse_navn="Samarbeid",
)
fig.show()
```

## Statlig sektor
Alle samarbeid tilhørende virksomheter som i Fia kategoriserers som Statlig forvaltning

```{python}

fig, _ = plot_tid_mellom_hendelser(
    df=data_i_statlig_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="fullfort",
    hendelse_navn="Samarbeid",
    yaxis_range_max=y_max,
)
fig.show()
```

## Kommunal sektor
Alle samarbeid tilhørende virksomheter som i Fia kategoriserers som Kommunal forvaltning

```{python}

fig, _ =plot_tid_mellom_hendelser(
    df=data_i_kommunal_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="fullfort",
    hendelse_navn="Samarbeid",
    yaxis_range_max=y_max,
)

fig.show()
```

## Privat sektor
Alle samarbeid tilhørende virksomheter som i Fia kategoriserers som Privat og offentlig næringsvirksomhet

```{python}

fig, _ = plot_tid_mellom_hendelser(
    df=data_i_privat_sektor,
    kolonne_start="opprettet",
    kolonne_slutt="fullfort",
    hendelse_navn="Samarbeid",
    yaxis_range_max=y_max,
)

fig.show()
```

:::


<!-- 
#TODO:
- Fra gjennomført evaluering til gjennomført samarbeid
- Filtrer inn-data på sektor
- Dropdown: Næring + Bransje
- Legend: multi plots, antall arbeidsforhold?

todo
# Plan

## Varighet innhold
Hvor lang varighet settes det for undertemaer / innhold i plan?
Fordel dette på sektor / Næring / Bransje (geografi skjer på resultatområde)

## Innhold i plan
Hvilke innhold er oftest med i plan?
Fordel dette på sektor / Næring / Bransje (geografi skjer på resultatområde)

## Endring av plan
Skjer det endringer på statuser på innhold en plan?
Fordel dette på sektor / Næring / Bransje (geografi skjer på resultatområde) ?

## Fullføring / Avbryting av plan
Skjer dette lenge før eller etter fristen?
Se datakvalitet fordeling før og etter antall dager.
Fordel dette på sektor / Næring / Bransje (geografi skjer på resultatområde)


# SF
## Aktiviteter på innhold
Hvor mange aktiviteter settes det i salesforce per type innhold?
Fordel dette på sektor / Næring / Bransje (geografi skjer på resultatområde) -->
