---
title: "Fia datafortelling"
execute:
    echo: false
    warning: false
format:
    html:
        toc: true
        page-layout: full
        embed-resources: true
jupyter: python3
---

Statistikk som viser bruk av Fagsystemet for IA (Fia).

Ansvarlig team er [Team Pia](https://teamkatalog.nav.no/team/b347ac99-c382-4e5a-a1dd-532e91110e2a).
 Kontakt oss på [slack](https://nav-it.slack.com/archives/C02DL347ZT2).


```{python}
import os
from datetime import datetime
import pytz

from code.helper import load_data, get_siste_status
from code.tables import antall_saker_per_status
from code.plots import aktive_saker_per_fylke, dager_siden_siste_oppdatering

PROJECT = os.environ['GCP_PROJECT']
DATASET = os.environ['DATASET']
data_statistikk = load_data(PROJECT, DATASET, "ia-sak-statistikk-v1")
data_leveranse = load_data(PROJECT, DATASET, "ia-sak-leveranse-v1")

siste_status = get_siste_status(data_statistikk)
data_statistikk = data_statistikk.merge(siste_status, on="saksnummer", how="left")
aktive_statuser = ["VURDERES", "KONTAKTES", "KARTLEGGES", "VI_BISTÅR"]
data_statistikk["aktiv_sak"] = data_statistikk.siste_status.isin(aktive_statuser)
```

## Antall saker

```{python}
print("Totalt antall saker: ", data_statistikk.saksnummer.nunique())
print("Antall aktive saker: ", data_statistikk[data_statistikk.aktiv_sak].saksnummer.nunique())
```

::: {.callout-note}

## Forklaring av begrepet "sak" i Fia

En sak i Fia er en tidsbegrenset vurdering, med eventuell bistand, av en virksomhet i IA-samarbeidet.

En aktiv sak i Fia er en sak som står i status Vurderes, Kontaktes, Kartlegges eller Vi bistår.

En sak er ansett som Avsluttet når den har fått status Ikke aktuell eller Fullført.
:::

## Saksgang i Fia

::: {.panel-tabset}
## Forenklet saksgang
![forenklet-saksgang](bilder/forenklet-saksgang.png)

## Komplett saksgang
![komplett-saksgang](bilder/komplett-saksgang.png)

:::

## Antall saker per status

```{python}
antall_saker_per_status(data_statistikk)
```
{{< include includes/status-forklaring.qmd >}}


## Antall aktive saker per fylke

```{python}
fig = aktive_saker_per_fylke(data_statistikk)
fig.show()
```

## Dager siden siste oppdatering i Fia

::: {.panel-tabset}
## Alle aktive saker
```{python}
fig = dager_siden_siste_oppdatering(data_statistikk, data_leveranse)
fig.show()
```
## Vurderes
```{python}
fig = dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="VURDERES"],
    data_leveranse
)
fig.show()
```
## Kontaktes
```{python}
fig = dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="KONTAKTES"],
    data_leveranse
)
fig.show()
```
## Kartlegges
```{python}
fig = dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="KARTLEGGES"],
    data_leveranse
)
fig.show()
```
## Vi bistår
```{python}
fig = dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="VI_BISTÅR"],
    data_leveranse
)
fig.show()
```
:::

---

```{python}
print("Denne siden ble generert {}".format(datetime.now(pytz.timezone("Europe/Oslo")).isoformat()))
```
