---
title: "Fia datafortelling"
execute:
    echo: false
    warning: false
format:
    html:
        toc: true
        page-layout: full
        embed-resources: true
jupyter: python3
---

Statistikk som viser bruk av Fagsystemet for IA (Fia).

Ansvarlig team er [Team Pia](https://teamkatalog.nav.no/team/b347ac99-c382-4e5a-a1dd-532e91110e2a).
 Kontakt oss på [slack](https://nav-it.slack.com/archives/C02DL347ZT2).


```{python}
import os
import plotly.express as px
from datetime import datetime, timezone

from code.helper import load_data, get_siste_status

PROJECT = os.environ['GCP_PROJECT']
DATASET = os.environ['DATASET']
data_statistikk = load_data(PROJECT, DATASET, "ia-sak-statistikk-v1")
data_leveranse = load_data(PROJECT, DATASET, "ia-sak-leveranse-v1")

siste_status = get_siste_status(data_statistikk)
data_statistikk = data_statistikk.merge(siste_status, on="saksnummer", how="left")
data_statistikk["aktiv_sak"] = ~data_statistikk.siste_status.isin(["IKKE_AKTUELL", "FULLFØRT", "NY"])
```

## Antall saker

```{python}
print("Totalt antall saker: ", data_statistikk.saksnummer.nunique())
print("Antall aktive saker: ", data_statistikk[data_statistikk.aktiv_sak].saksnummer.nunique())
```

::: {.callout-note}

## Forklaring av begrepet "sak" i Fia

En sak i Fia er en tidsbegrenset vurdering, med eventuell bistand, av en virksomhet i IA-samarbeidet.

En aktiv sak i Fia er en sak som står i status Vurderes, Kontaktes, Kartlegges eller Vi bistår.

En sak er ansett som Avsluttet når den har fått status Ikke aktuell eller Fullført.
:::

## Saksgang i Fia

::: {.panel-tabset}
## Forenklet saksgang
![forenklet-saksgang](bilder/forenklet-saksgang.png)

## Komplett saksgang
![komplett-saksgang](bilder/komplett-saksgang.png)

:::

## Antall saker per status

```{python}
from code.tables import antall_saker_per_status
antall_saker_per_status(data_statistikk)
```
::: {.callout-note collapse="true"}
## Forklaring av de forskjellige statusene i Fia

*   Vurderes

    Forklaring av Vurderes kommer på ett senere tidspunkt.
*   Kontaktes

    Forklaring av Kontaktes kommer på ett senere tidspunkt.
*   Kartlegges

    Forklaring av Kartlegges kommer på ett senere tidspunkt.
*   Vi bistår

    Forklaring av Vi bistår kommer på ett senere tidspunkt.
*   Fullført

    Forklaring av Fullført kommer på ett senere tidspunkt.
*   Ikke aktuell

    Forklaring av Ikke aktuell kommer på ett senere tidspunkt.
:::


## Antall aktive saker per fylke

```{python}
from code.plots import aktive_saker_per_fylke
fig = aktive_saker_per_fylke(data_statistikk)
fig.show()
```

## Dager siden siste oppdatering i Fia

```{python}
from code.plots import dager_siden_siste_oppdatering
fig = dager_siden_siste_oppdatering(data_statistikk, data_leveranse)
fig.show()
```

---

```{python}
import pytz

print("Denne siden ble generert {}".format(datetime.now(pytz.timezone("Europe/Oslo")).isoformat()))
```
