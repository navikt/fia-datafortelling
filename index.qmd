---
title: "Fia datafortelling"
execute:
    echo: false
    warning: false
format:
    html:
        toc: true
        toc-title: Indeks
        page-layout: full
        embed-resources: true
jupyter: python3
---

Statistikk som viser bruk av Fagsystemet for IA (Fia).

Ansvarlig team er [Team Pia](https://teamkatalog.nav.no/team/b347ac99-c382-4e5a-a1dd-532e91110e2a).
 Kontakt oss på [slack](https://nav-it.slack.com/archives/C02DL347ZT2) eller på e-post `pia` ved `nav.no`. 


```{python}
import os
from datetime import datetime
import pytz

from code.helper import (
    load_data,
    preprocess_data_statistikk,
    preprocess_data_leveranse,
)
from code.plots import (
    aktive_saker_per_fylke,
    dager_siden_siste_oppdatering,
    antall_saker_per_status,
    antall_leveranser_per_sak,
    antall_leveranser_per_tjeneste,
    antall_leveranser_per_modul,
    virksomhetsprofil,
    statusflyt,
)
from code.tables import moduler_per_maaned

PROJECT = os.environ['GCP_PROJECT']
DATASET = os.environ['DATASET']
data_statistikk = load_data(PROJECT, DATASET, "ia-sak-statistikk-v1")
data_leveranse = load_data(PROJECT, DATASET, "ia-sak-leveranse-v1")

data_statistikk = preprocess_data_statistikk(data_statistikk)
data_leveranse = preprocess_data_leveranse(data_leveranse)
```

## Antall saker

```{python}
print("Totalt antall saker: ", data_statistikk.saksnummer.nunique())
print("Antall aktive saker: ", data_statistikk[data_statistikk.aktiv_sak].saksnummer.nunique())
```

::: {.callout-note}

## Forklaring av begrepet "sak" i Fia

En sak i Fia er en tidsbegrenset vurdering, med eventuell bistand, av en virksomhet i IA-samarbeidet.

En aktiv sak i Fia er en sak som står i status Vurderes, Kontaktes, Kartlegges eller Vi bistår.

En sak er ansett som Avsluttet når den har fått status Ikke aktuell eller Fullført.
:::

## Saksgang i Fia

::: {.panel-tabset}
## Forenklet saksgang
![forenklet-saksgang](bilder/forenklet-saksgang.png)

## Komplett saksgang
![komplett-saksgang](bilder/komplett-saksgang.png)

:::

## Antall saker per status

```{python}
antall_saker_per_status(data_statistikk[data_statistikk.siste_status!="SLETTET"])
```
{{< include includes/status-forklaring.qmd >}}


## Antall aktive saker per fylke

```{python}
aktive_saker_per_fylke(data_statistikk)
```

## Dager siden siste oppdatering i Fia

::: {.panel-tabset}
## Alle aktive saker
```{python}
dager_siden_siste_oppdatering(data_statistikk, data_leveranse)
```
## Vurderes
```{python}
dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="VURDERES"],
    data_leveranse
)
```
## Kontaktes
```{python}
dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="KONTAKTES"],
    data_leveranse
)
```
## Kartlegges
```{python}
dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="KARTLEGGES"],
    data_leveranse
)
```
## Vi bistår
```{python}
dager_siden_siste_oppdatering(
    data_statistikk[data_statistikk.siste_status=="VI_BISTÅR"],
    data_leveranse
)
```
:::


## Leveranser

::: {.panel-tabset}

## Per tjeneste
```{python}
antall_leveranser_per_tjeneste(data_leveranse)
```

## Per modul
```{python}
antall_leveranser_per_modul(data_leveranse)
```

## Per sak
```{python}
antall_leveranser_per_sak(data_leveranse)
```

## Fullførte per måned
```{python}
moduler_per_maaned(data_leveranse)
```

:::


# Virksomhetsprofil

::: {.panel-tabset}

## Aktive saker
```{python}
data_input = data_statistikk[data_statistikk.aktiv_sak]
virksomhetsprofil(data_input, title="Saker med nåværende status Vurderes, Kontaktes, Kartlegges, eller Vi bistår")
```

## Vurderte
```{python}
data_input = data_statistikk[data_statistikk.status=="VURDERES"].drop_duplicates("saksnummer", keep="last")
virksomhetsprofil(data_input, title="Saker som hadde eller har status Vurderes")
```

## Vurderte ikke aktuell
```{python}
data_input = data_statistikk[
    (data_statistikk.status=="IKKE_AKTUELL") &
    (data_statistikk.forrige_status=="VURDERES")
].drop_duplicates("saksnummer", keep="last")
virksomhetsprofil(data_input, title="Saker som gikk fra status Vurderes til Ikke aktuell")
```
:::


# Statusflyt
```{python}
statusflyt(data_statistikk)
```

---

```{python}
print("Denne siden ble generert {}".format(datetime.now(pytz.timezone("Europe/Oslo")).isoformat()))
```
